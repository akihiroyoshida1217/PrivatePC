# Generated by iptables-save v1.6.0 on Sat Jun 30 18:06:43 2018
*filter

-A OUTPUT -d {{ private_network_address }}  -p tcp --dport 80 -j ACCEPT
-A OUTPUT -d {{ private_network_address }}  -p tcp --dport 443 -j ACCEPT
-A OUTPUT -d {{ private_network_address }}  -p tcp --dport 22 -j ACCEPT
-A OUTPUT -d {{ private_network_address }}  -p tcp --dport 23 -j ACCEPT
-A OUTPUT -d {{ private_network_address }}  -p tcp --dport 3389 -j ACCEPT
-A OUTPUT -d {{ private_network_address }}  -p tcp --dport 139 -j ACCEPT
-A OUTPUT -d {{ private_network_address }}  -p tcp --dport 445 -j ACCEPT
-A OUTPUT -d 172.23.0.0/24 -p tcp --dport 5900 -j ACCEPT

-A INPUT -i lo -j ACCEPT
-A INPUT ! -i lo -d 127.0.0.0/8 -j REJECT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT ! -o lo -d 127.0.0.0/8 -j REJECT
#-A OUTPUT -i lo -p icmp --icmp-type any -j REJECT

-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
#-A OUTPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

-A OUTPUT -p udp --dport 53 -j ACCEPT

# ntp.nict.jp
{% for ip in ntp_nict_jp.stdout_lines %}
-A OUTPUT -d {{ ip }} -p udp --dport 123 -j ACCEPT
{% endfor %}

# ftp.nara.wide.ad.jp
{% for ip in ftp_nara_wide_ad_jp.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# ftp.tsukuba.wide.ad.jp
{% for ip in ftp_tsukuba_wide_ad_jp.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# dennou-h.gfd-dennou.org
{% for ip in dennou_h_gfd_dennou_org.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# dennou-k.gfd-dennou.org
{% for ip in dennou_k_gfd_dennou_org.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# dennou-q.gfd-dennou.org
{% for ip in dennou_q_gfd_dennou_org.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# debian-mirror.sakura.ne.jp
{% for ip in debian_mirror_sakura_ne_jp.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# riksun.riken.go.jp
{% for ip in riksun_riken_go_jp.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# infoserv.ics.es.osaka-u.ac.jp
{% for ip in infoserv_ics_es_osaka_u_ac_jp.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# ftp.kddilabs.jp
{% for ip in ftp_kddilabs_jp.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# ring.shibaura-it.ac.jp
{% for ip in ring_shibaura_it_ac_jp.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# ring.u-toyama.ac.jp
{% for ip in ring_u_toyama_ac_jp.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# ring.airnet.ne.jp
{% for ip in ring_airnet_ne_jp.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# ring.ix.oita-u.ac.jp
{% for ip in ring_ix_oita_u_ac_jp.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# security.debian.org
{% for ip in security_debian_org.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# ftp.jp.debian.org(jp.cdn.araki.net)
{% for ip in ftp_jp_debian_org.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}

# download.docker.com(d2h67oheeuigaw.cloudfront.net)
{% for ip in download_docker_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
# auth.docker.io
{% for ip in auth_docker_io.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
# registry-1.docker.io
{% for ip in registry_1_docker_io.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
# production.cloudflare.docker.com
{% for ip in production_cloudflare_docker_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}

# github.com
{% for ip in github_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
# codeload.github.com
{% for ip in codeload_github_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}

# security-cdn.debian.org(prod.debian.map.fastly.net)
{% for ip in prod_debian_map_fastly_net.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}

# ppa.launchpad.net
{% for ip in ppa_launchpad_net.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
{% for ip in ppa_launchpad_net.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
# launchpad-net.nutmeg.canonical.com
-A OUTPUT -d 91.189.89.222 -p tcp --dport 443 -j ACCEPT
# launchpad-net.banana.canonical.com
-A OUTPUT -d 91.189.89.223 -p tcp --dport 443 -j ACCEPT

# keyserver.ubuntu.com
{% for ip in keyserver_ubuntu_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# keyserver.ubuntu.com
{% for ip in keyserver_ubuntu_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
# keyserver.ubuntu.com
{% for ip in keyserver_ubuntu_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 11371 -j ACCEPT
{% endfor %}

# extentions.gnome.org(openshift.gnome.org)
{% for ip in openshift_gnome_org.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}

# pypi.org
{% for ip in pypi_org.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
{% for ip in pypi_org.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}

# bootstrap.pypa.io(dualstack.c.ssl.global.fastly.net)
{% for ip in bootstrap_pypa_io.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
{% for ip in bootstrap_pypa_io.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}

# pypi.python.org(dualstack.python.map.fastly.net)
{% for ip in pypi_python_org.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}

# files.pythonhosted.org(dualstack.r.ssl.global.fastly.net)
{% for ip in files_pythonhosted_org.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}

# packages.microsoft.com(csd-apt-eas-d-1.eastasia.cloudapp.azure.com)
{% for ip in csd_apt_eas_d_1_eastasia_cloudapp_azure_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
# packages.microsoft.com(csd-apt-eas-d-2.eastasia.cloudapp.azure.com)
{% for ip in csd_apt_eas_d_2_eastasia_cloudapp_azure_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
# packages.microsoft.com(csd-apt-eas-d-3.eastasia.cloudapp.azure.com)
{% for ip in csd_apt_eas_d_3_eastasia_cloudapp_azure_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
# packages.microsoft.com(csd-apt-eas-d-4.eastasia.cloudapp.azure.com)
{% for ip in csd_apt_eas_d_4_eastasia_cloudapp_azure_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}
# packages.microsoft.com(csd-apt-eas-d-1.eastasia.cloudapp.azure.com)
{% for ip in csd_apt_eas_d_1_eastasia_cloudapp_azure_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# packages.microsoft.com(csd-apt-eas-d-2.eastasia.cloudapp.azure.com)
{% for ip in csd_apt_eas_d_2_eastasia_cloudapp_azure_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# packages.microsoft.com(csd-apt-eas-d-3.eastasia.cloudapp.azure.com)
{% for ip in csd_apt_eas_d_3_eastasia_cloudapp_azure_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}
# packages.microsoft.com(csd-apt-eas-d-4.eastasia.cloudapp.azure.com)
{% for ip in csd_apt_eas_d_4_eastasia_cloudapp_azure_com.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 80 -j ACCEPT
{% endfor %}

# database.clamav.net(database.clamav.net.cdn.cloudflare.net)
{% for ip in database_clamav_net_cdn_cloudflare_net.stdout_lines %}
-A OUTPUT -d {{ ip }} -p tcp --dport 443 -j ACCEPT
{% endfor %}

-A INPUT -j LOG --log-prefix "iptables denied: " --log-level 7
-A OUTPUT -j LOG --log-prefix "iptables denied: " --log-level 7

#-A OUTPUT -j ACCEPT
-A OUTPUT -j REJECT
-A INPUT -j REJECT
-A FORWARD -j REJECT

COMMIT
# Completed on Sat Jun 30 18:06:43 2018
